<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Making a measurement &mdash; PyMeasure 0.9.0 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using a graphical interface" href="graphical.html" />
    <link rel="prev" title="Connecting to an instrument" href="connecting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> PyMeasure
          </a>
              <div class="version">
                0.9.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p><span class="caption-text">Learning PyMeasure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="connecting.html">Connecting to an instrument</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Making a measurement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-scripts">Using scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-procedures">Using Procedures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-procedures">Running Procedures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-logs">Using Logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-our-script">Modifying our script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="graphical.html">Using a graphical interface</a></li>
</ul>
</li>
</ul>
<p><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/adapters.html">pymeasure.adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/experiment/index.html">pymeasure.experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/display/index.html">pymeasure.display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/instruments/index.html">pymeasure.instruments</a></li>
</ul>
<p><span class="caption-text">Getting involved</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/contribute.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/reporting_errors.html">Reporting an error</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/adding_instruments.html">Adding instruments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/coding_standards.html">Coding Standards</a></li>
</ul>
<p><span class="caption-text">About PyMeasure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyMeasure</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      <li>Making a measurement</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/procedure.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="making-a-measurement">
<h1>Making a measurement<a class="headerlink" href="#making-a-measurement" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will walk you through using PyMeasure to acquire a current-voltage (IV) characteristic using a Keithley 2400. Even if you don’t have access to this instrument, this tutorial will explain the method for making measurements with PyMeasure. First we describe using a simple script to make the measurement. From there, we show how <a class="reference internal" href="../api/experiment/procedure.html#module-pymeasure.experiment.procedure" title="pymeasure.experiment.procedure"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Procedure</span></code></a> objects greatly simplify the workflow, which leads to making the measurement with a graphical interface.</p>
<section id="using-scripts">
<h2>Using scripts<a class="headerlink" href="#using-scripts" title="Permalink to this headline">¶</a></h2>
<p>Scripts are a quick way to get up and running with a measurement in PyMeasure. For our IV characteristic measurement, we perform the following steps:</p>
<ol class="arabic simple">
<li><p>Import the necessary packages</p></li>
<li><p>Set the input parameters to define the measurement</p></li>
<li><p>Connect to the Keithley 2400</p></li>
<li><p>Set up the instrument for the IV characteristic</p></li>
<li><p>Allocate arrays to store the resulting measurements</p></li>
<li><p>Loop through the current points, measure the voltage, and record</p></li>
<li><p>Save the final data to a CSV file</p></li>
<li><p>Shutdown the instrument</p></li>
</ol>
<p>These steps are expressed in code as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import necessary packages</span>
<span class="kn">from</span> <span class="nn">pymeasure.instruments.keithley</span> <span class="kn">import</span> <span class="n">Keithley2400</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="c1"># Set the input parameters</span>
<span class="n">data_points</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">averages</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">max_current</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">min_current</span> <span class="o">=</span> <span class="o">-</span><span class="n">max_current</span>

<span class="c1"># Connect and configure the instrument</span>
<span class="n">sourcemeter</span> <span class="o">=</span> <span class="n">Keithley2400</span><span class="p">(</span><span class="s2">&quot;GPIB::4&quot;</span><span class="p">)</span>
<span class="n">sourcemeter</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">sourcemeter</span><span class="o">.</span><span class="n">use_front_terminals</span><span class="p">()</span>
<span class="n">sourcemeter</span><span class="o">.</span><span class="n">measure_voltage</span><span class="p">()</span>
<span class="n">sourcemeter</span><span class="o">.</span><span class="n">config_current_source</span><span class="p">()</span>
<span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># wait here to give the instrument time to react</span>
<span class="n">sourcemeter</span><span class="o">.</span><span class="n">set_buffer</span><span class="p">(</span><span class="n">averages</span><span class="p">)</span>

<span class="c1"># Allocate arrays to store the measurement results</span>
<span class="n">currents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_current</span><span class="p">,</span> <span class="n">max_current</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">data_points</span><span class="p">)</span>
<span class="n">voltages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">currents</span><span class="p">)</span>
<span class="n">voltage_stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">currents</span><span class="p">)</span>

<span class="c1"># Loop through each current point, measure and record the voltage</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data_points</span><span class="p">):</span>
    <span class="n">sourcemeter</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">currents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">sourcemeter</span><span class="o">.</span><span class="n">reset_buffer</span><span class="p">()</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">sourcemeter</span><span class="o">.</span><span class="n">start_buffer</span><span class="p">()</span>
    <span class="n">sourcemeter</span><span class="o">.</span><span class="n">wait_for_buffer</span><span class="p">()</span>

    <span class="c1"># Record the average and standard deviation</span>
    <span class="n">voltages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourcemeter</span><span class="o">.</span><span class="n">means</span>
    <span class="n">voltage_stds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sourcemeter</span><span class="o">.</span><span class="n">standard_devs</span>

<span class="c1"># Save the data columns in a CSV file</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Current (A)&#39;</span><span class="p">:</span> <span class="n">currents</span><span class="p">,</span>
    <span class="s1">&#39;Voltage (V)&#39;</span><span class="p">:</span> <span class="n">voltages</span><span class="p">,</span>
    <span class="s1">&#39;Voltage Std (V)&#39;</span><span class="p">:</span> <span class="n">voltage_stds</span><span class="p">,</span>
<span class="p">})</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;example.csv&#39;</span><span class="p">)</span>

<span class="n">sourcemeter</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<p>Running this example script will execute the measurement and save the data to a CSV file. While this may be sufficient for very basic measurements, this example illustrates a number of issues that PyMeasure solves. The issues with the script example include:</p>
<ul class="simple">
<li><p>The progress of the measurement is not transparent</p></li>
<li><p>Input parameters are not associated with the data that is saved</p></li>
<li><p>Data is not plotted during the execution (nor at all in this case)</p></li>
<li><p>Data is only saved upon successful completion, which is otherwise lost</p></li>
<li><p>Canceling a running measurement causes the system to end in a undetermined state</p></li>
<li><p>Exceptions also end the system in an undetermined state</p></li>
</ul>
<p>The <a class="reference internal" href="../api/experiment/procedure.html#pymeasure.experiment.procedure.Procedure" title="pymeasure.experiment.procedure.Procedure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Procedure</span></code></a> class allows us to solve all of these issues. The next section introduces the <a class="reference internal" href="../api/experiment/procedure.html#pymeasure.experiment.procedure.Procedure" title="pymeasure.experiment.procedure.Procedure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Procedure</span></code></a> class and shows how to modify our script example to take advantage of these features.</p>
</section>
<section id="using-procedures">
<h2>Using Procedures<a class="headerlink" href="#using-procedures" title="Permalink to this headline">¶</a></h2>
<p>The Procedure object bundles the sequence of steps in an experiment with the parameters required for its successful execution. This simple structure comes with huge benefits, since a number of convenient tools for making the measurement use this common interface.</p>
<p>Let’s start with a simple example of a procedure which loops over a certain number of iterations. We make the SimpleProcedure object as a sub-class of Procedure, since SimpleProcedure <em>is a</em> Procedure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">Procedure</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">IntegerParameter</span>

<span class="k">class</span> <span class="nc">SimpleProcedure</span><span class="p">(</span><span class="n">Procedure</span><span class="p">):</span>

    <span class="c1"># a Parameter that defines the number of loop iterations</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="s1">&#39;Loop Iterations&#39;</span><span class="p">)</span>

    <span class="c1"># a list defining the order and appearance of columns in our data file</span>
    <span class="n">DATA_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Iteration&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loops over each iteration and emits the current iteration,</span>
<span class="sd">        before waiting for 0.01 sec, and then checking if the procedure</span>
<span class="sd">        should stop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Iteration&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">})</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_stop</span><span class="p">():</span>
                <span class="k">break</span>
</pre></div>
</div>
<p>At the top of the SimpleProcedure class we define the required Parameters. In this case, <code class="code python docutils literal notranslate"><span class="name"><span class="pre">iterations</span></span></code> is a IntegerParameter that defines the number of loops to perform. Inside our Procedure class we reference the value in the iterations Parameter by the class variable where the Parameter is stored (<code class="code python docutils literal notranslate"><span class="name builtin pseudo"><span class="pre">self</span></span><span class="operator"><span class="pre">.</span></span><span class="name"><span class="pre">iterations</span></span></code>). PyMeasure swaps out the Parameters with their values behind the scene, which makes accessing the values of parameters very convenient.</p>
<p>We define the data columns that will be recorded in a list stored in <code class="code python docutils literal notranslate"><span class="name"><span class="pre">DATA_COLUMNS</span></span></code>. This sets the order by which columns are stored in the file. In this example, we will store the Iteration number for each loop iteration.</p>
<p>The <code class="code python docutils literal notranslate"><span class="name"><span class="pre">execute</span></span></code> methods defines the main body of the procedure. Our example method consists of a loop over the number of iterations, in which we emit the data to be recorded (the Iteration number). The data is broadcast to any number of listeners by using the <code class="code docutils literal notranslate"><span class="pre">emit</span></code> method, which takes a topic as the first argument. Data with the <code class="code python docutils literal notranslate"><span class="literal string single"><span class="pre">‘results’</span></span></code> topic and the proper data columns will be recorded to a file. The sleep function in our example provides two very useful features. The first is to delay the execution of the next lines of code by the time argument in units of seconds. The seconds is that during this delay time, the CPU is free to perform other code. Successful measurements often require the intelligent use of sleep to deal with instrument delays and ensure that the CPU is not hogged by a single script. After our delay, we check to see if the Procedure should stop by calling <code class="code python docutils literal notranslate"><span class="name builtin pseudo"><span class="pre">self</span></span><span class="operator"><span class="pre">.</span></span><span class="name"><span class="pre">should_stop</span></span><span class="punctuation"><span class="pre">()</span></span></code>. By checking this flag, the Procedure will react to a user canceling the procedure execution.</p>
<p>This covers the basic requirements of a Procedure object. Now let’s construct our SimpleProcedure object with 100 iterations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">procedure</span> <span class="o">=</span> <span class="n">SimpleProcedure</span><span class="p">()</span>
<span class="n">procedure</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>Next we will show how to run the procedure.</p>
<section id="running-procedures">
<h3>Running Procedures<a class="headerlink" href="#running-procedures" title="Permalink to this headline">¶</a></h3>
<p>A Procedure is run by a Worker object. The Worker executes the Procedure in a separate Python thread, which allows other code to execute in parallel to the procedure (e.g. a graphical user interface). In addition to performing the measurement, the Worker spawns a Recorder object, which listens for the <code class="code python docutils literal notranslate"><span class="literal string single"><span class="pre">‘results’</span></span></code> topic in data emitted by the Procedure, and writes those lines to a data file. The Results object provides a convenient abstraction to keep track of where the data should be stored, the data in an accessible form, and the Procedure that pertains to those results.</p>
<p>We first construct a Results object for our Procedure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">Results</span>

<span class="n">data_filename</span> <span class="o">=</span> <span class="s1">&#39;example.csv&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">Results</span><span class="p">(</span><span class="n">procedure</span><span class="p">,</span> <span class="n">data_filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Constructing the Results object for our Procedure creates the file using the <code class="code python docutils literal notranslate"><span class="name"><span class="pre">data_filename</span></span></code>, and stores the Parameters for the Procedure. This allows the Procedure and Results objects to be reconstructed later simply by loading the file using <code class="code python docutils literal notranslate"><span class="name"><span class="pre">Results</span></span><span class="operator"><span class="pre">.</span></span><span class="name"><span class="pre">load</span></span><span class="punctuation"><span class="pre">(</span></span><span class="name"><span class="pre">data_filename</span></span><span class="punctuation"><span class="pre">)</span></span></code>. The Parameters in the file are easily readable.</p>
<p>We now construct a Worker with the Results object, since it contains our Procedure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">Worker</span>

<span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<p>The Worker publishes data and other run-time information through specific queues, but can also publish this information over the local network on a specific TCP port (using the optional <code class="code python docutils literal notranslate"><span class="name"><span class="pre">port</span></span></code> argument. Using TCP communication allows great flexibility for sharing information with Listener objects. Queues are used as the standard communication method because they preserve the data order, which is of critical importance to storing data accurately and reacting to the measurement status in order.</p>
<p>Now we are ready to start the worker.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>This method starts the worker in a separate Python thread, which allows us to perform other tasks while it is running. When writing a script that should block (wait for the Worker to finish), we need to join the Worker back into the main thread.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">worker</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span> <span class="c1"># wait at most 1 hr (3600 sec)</span>
</pre></div>
</div>
<p>Let’s put all the pieces together. Our SimpleProcedure can be run in a script by the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">Procedure</span><span class="p">,</span> <span class="n">Results</span><span class="p">,</span> <span class="n">Worker</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">IntegerParameter</span>

<span class="k">class</span> <span class="nc">SimpleProcedure</span><span class="p">(</span><span class="n">Procedure</span><span class="p">):</span>

    <span class="c1"># a Parameter that defines the number of loop iterations</span>
    <span class="n">iterations</span> <span class="o">=</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="s1">&#39;Loop Iterations&#39;</span><span class="p">)</span>

    <span class="c1"># a list defining the order and appearance of columns in our data file</span>
    <span class="n">DATA_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Iteration&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loops over each iteration and emits the current iteration,</span>
<span class="sd">        before waiting for 0.01 sec, and then checking if the procedure</span>
<span class="sd">        should stop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Iteration&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">})</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_stop</span><span class="p">():</span>
                <span class="k">break</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">procedure</span> <span class="o">=</span> <span class="n">SimpleProcedure</span><span class="p">()</span>
    <span class="n">procedure</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">data_filename</span> <span class="o">=</span> <span class="s1">&#39;example.csv&#39;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">Results</span><span class="p">(</span><span class="n">procedure</span><span class="p">,</span> <span class="n">data_filename</span><span class="p">)</span>

    <span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">worker</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span> <span class="c1"># wait at most 1 hr (3600 sec)</span>
</pre></div>
</div>
<p>Here we have included an if statement to only run the script if the __name__ is __main__. This precaution allows us to import the SimpleProcedure object without running the execution.</p>
</section>
<section id="using-logs">
<h3>Using Logs<a class="headerlink" href="#using-logs" title="Permalink to this headline">¶</a></h3>
<p>Logs keep track of important details in the execution of a procedure. We describe the use of the Python logging module with PyMeasure, which makes it easy to document the execution of a procedure and provides useful insight when diagnosing issues or bugs.</p>
<p>Let’s extend our SimpleProcedure with logging.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">NullHandler</span><span class="p">())</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">pymeasure.log</span> <span class="kn">import</span> <span class="n">console_log</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">Procedure</span><span class="p">,</span> <span class="n">Results</span><span class="p">,</span> <span class="n">Worker</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">IntegerParameter</span>

<span class="k">class</span> <span class="nc">SimpleProcedure</span><span class="p">(</span><span class="n">Procedure</span><span class="p">):</span>

    <span class="n">iterations</span> <span class="o">=</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="s1">&#39;Loop Iterations&#39;</span><span class="p">)</span>

    <span class="n">DATA_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Iteration&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting the loop of </span><span class="si">%d</span><span class="s2"> iterations&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Iteration&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Emitting results: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_stop</span><span class="p">():</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Caught the stop flag in the procedure&quot;</span><span class="p">)</span>
                <span class="k">break</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">console_log</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Constructing a SimpleProcedure&quot;</span><span class="p">)</span>
    <span class="n">procedure</span> <span class="o">=</span> <span class="n">SimpleProcedure</span><span class="p">()</span>
    <span class="n">procedure</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">data_filename</span> <span class="o">=</span> <span class="s1">&#39;example.csv&#39;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Constructing the Results with a data file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data_filename</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">Results</span><span class="p">(</span><span class="n">procedure</span><span class="p">,</span> <span class="n">data_filename</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Constructing the Worker&quot;</span><span class="p">)</span>
    <span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started the Worker&quot;</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Joining with the worker in at most 1 hr&quot;</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span> <span class="c1"># wait at most 1 hr (3600 sec)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished the measurement&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we have imported the Python logging module and grabbed the logger using the <code class="code python docutils literal notranslate"><span class="name variable magic"><span class="pre">__name__</span></span></code> argument. This gives us logging information specific to the current file. Conversely, we could use the <code class="code python docutils literal notranslate"><span class="literal string single"><span class="pre">‘’</span></span></code> argument to get all logs, including those of pymeasure. We use the <code class="code python docutils literal notranslate"><span class="name"><span class="pre">console_log</span></span></code> function to conveniently output the log to the console. Further details on how to use the logger are addressed in the Python logging documentation.</p>
</section>
<section id="modifying-our-script">
<h3>Modifying our script<a class="headerlink" href="#modifying-our-script" title="Permalink to this headline">¶</a></h3>
<p>Now that you have a background on how to use the different features of the Procedure class, and how they are run, we will revisit our IV characteristic measurement using Procedures. Below we present the modified version of our example script, now as a IVProcedure class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import necessary packages</span>
<span class="kn">from</span> <span class="nn">pymeasure.instruments.keithley</span> <span class="kn">import</span> <span class="n">Keithley2400</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">Procedure</span>
<span class="kn">from</span> <span class="nn">pymeasure.experiment</span> <span class="kn">import</span> <span class="n">IntegerParameter</span><span class="p">,</span> <span class="n">FloatParameter</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">class</span> <span class="nc">IVProcedure</span><span class="p">(</span><span class="n">Procedure</span><span class="p">):</span>

    <span class="n">data_points</span> <span class="o">=</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="s1">&#39;Data points&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">averages</span> <span class="o">=</span> <span class="n">IntegerParameter</span><span class="p">(</span><span class="s1">&#39;Averages&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">max_current</span> <span class="o">=</span> <span class="n">FloatParameter</span><span class="p">(</span><span class="s1">&#39;Maximum Current&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">min_current</span> <span class="o">=</span> <span class="n">FloatParameter</span><span class="p">(</span><span class="s1">&#39;Minimum Current&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="n">DATA_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="s1">&#39;Voltage (V)&#39;</span><span class="p">,</span> <span class="s1">&#39;Voltage Std (V)&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connecting and configuring the instrument&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span> <span class="o">=</span> <span class="n">Keithley2400</span><span class="p">(</span><span class="s2">&quot;GPIB::4&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">use_front_terminals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">measure_voltage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">config_current_source</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="c1"># wait here to give the instrument time to react</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">set_buffer</span><span class="p">(</span><span class="n">averages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">currents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_current</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_current</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_points</span>
        <span class="p">)</span>

        <span class="c1"># Loop through each current point, measure and record the voltage</span>
        <span class="k">for</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">currents</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting the current to </span><span class="si">%g</span><span class="s2"> A&quot;</span> <span class="o">%</span> <span class="n">current</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">current</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">reset_buffer</span><span class="p">()</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">start_buffer</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for the buffer to fill with measurements&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">wait_for_buffer</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">&#39;Current (A)&#39;</span><span class="p">:</span> <span class="n">current</span><span class="p">,</span>
                <span class="s1">&#39;Voltage (V)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">means</span><span class="p">,</span>
                <span class="s1">&#39;Voltage Std (V)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">standard_devs</span>
            <span class="p">})</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_stop</span><span class="p">():</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User aborted the procedure&quot;</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcemeter</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished measuring&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">console_log</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Constructing an IVProcedure&quot;</span><span class="p">)</span>
    <span class="n">procedure</span> <span class="o">=</span> <span class="n">IVProcedure</span><span class="p">()</span>
    <span class="n">procedure</span><span class="o">.</span><span class="n">data_points</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">procedure</span><span class="o">.</span><span class="n">averages</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">procedure</span><span class="o">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.01</span>
    <span class="n">procedure</span><span class="o">.</span><span class="n">min_current</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="n">data_filename</span> <span class="o">=</span> <span class="s1">&#39;example.csv&#39;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Constructing the Results with a data file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data_filename</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">Results</span><span class="p">(</span><span class="n">procedure</span><span class="p">,</span> <span class="n">data_filename</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Constructing the Worker&quot;</span><span class="p">)</span>
    <span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Started the Worker&quot;</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Joining with the worker in at most 1 hr&quot;</span><span class="p">)</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span> <span class="c1"># wait at most 1 hr (3600 sec)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished the measurement&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, you are familiar with how to construct a Procedure sub-class. The next section shows how to put these procedures to work in a graphical environment, where will have live-plotting of the data and the ability to easily queue up a number of experiments in sequence. All of these features come from using the Procedure object.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="connecting.html" class="btn btn-neutral float-left" title="Connecting to an instrument" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="graphical.html" class="btn btn-neutral float-right" title="Using a graphical interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2021, PyMeasure Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>